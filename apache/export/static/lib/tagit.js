(function(e){e.fn.autoGrowInput=function(t){t=e.extend({maxWidth:1e3,minWidth:0,comfortZone:70},t);this.filter("input:text").each(function(){var n=t.minWidth||e(this).width(),r="",i=e(this),s=e("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"}),u=function(){if(r===(r=i.val())){return}var e=r.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">");s.html(e);var u=s.width(),a=u+t.comfortZone>=n?u+t.comfortZone:n,f=i.width(),l=a<f&&a>=n||a>n&&a<t.maxWidth;if(l){i.css("cssText","width: "+a+"px !important")}};s.insertAfter(i);e(this).bind("keyup keydown blur update",u)});return this}})(jQuery);(function(e){e.widget("ui.tagit",{options:{tagSource:[],triggerKeys:["enter","space","comma","tab","semicolon"],seperatorKeys:["comma","semicolon"],initialTags:[],minLength:1,select:false,allowNewTags:true,caseSensitive:false,sortable:false,highlightOnExistColor:"#0F0",emptySearch:true,tagsChanged:function(e,t,n){},maxTags:undefined,blurOnPaste:true},_splitAt:/\ |,/g,_existingAtIndex:0,_keys:{backspace:[8],enter:[13],space:[32],comma:[44,188],tab:[9],semicolon:[59,186]},_sortable:{sorting:-1},_create:function(){var t=this;this.tagsArray=[];this.timer=null;this.element.addClass("tagit");this.element.children("li").each(function(){var n=e(this);var r=n.attr("tagValue")||n.data("value");t.options.initialTags.push({label:n.text(),value:r?r:n.text()})});pushRegex=function(r,i,s){if(e.inArray(i,t.options.seperatorKeys)!=-1){n.push(s)}};t._splitAt=null;var n=[];pushRegex(n,"space",/\ /);pushRegex(n,"semicolon",/;/);pushRegex(n,"comma",/,/);var r=e.map(n,function(e){return e.source}).join("|");t._splitAt=new RegExp(r,"g");this.element.html('<li class="tagit-new"><input class="tagit-input" type="text" /></li>');this.input=this.element.find(".tagit-input");this.input.autoGrowInput();e(this.element).click(function(n){if(e(n.target).hasClass("tagit-close")){var r=e(n.target).parent();var i=t.tagsArray[r.index()];i.element.remove();t._popTag(i)}else{t.input.focus();if(t.options.emptySearch&&e(n.target).hasClass("tagit-input")&&t.input.val()==""&&t.input.autocomplete!=undefined){t.input.autocomplete("search")}}});var i=this.options.select;this.options.appendTo=this.element;this.options.source=this.options.tagSource;this.options.select=function(e,n){t.input.data("autoCompleteTag",true);clearTimeout(t.timer);if(t.options.maxTags!==undefined&&t.tagsArray.length==t.options.maxTags){t.input.val("")}else{if(n.item.label===undefined)t._addTag(n.item.value);else t._addTag(n.item.label,n.item.value)}return false},this.options.focus=function(e,n){if(n.item.label!==undefined&&/^key/.test(e.originalEvent.originalEvent.type)){t.input.val(n.item.label);t.input.data("value",n.item.value);return false}};this.options.autoFocus=!this.options.allowNewTags;this.input.autocomplete(this.options);this.options.select=i;this.input.keydown(function(n){var r=t.element.children(".tagit-choice:last");if(n.which==t._keys.backspace)return t._backspace(r);if(t._isInitKey(n.which)&&!(t._isTabKey(n.which)&&this.value==""&&!t.input.data("autoCompleteTag"))){n.preventDefault();t.input.data("autoCompleteTag",false);if(!t.options.allowNewTags||t.options.maxTags!==undefined&&t.tagsArray.length==t.options.maxTags){t.input.val("")}else if(t.options.allowNewTags&&e(this).val().length>=t.options.minLength){t._addTag(e(this).val())}}if(t.options.maxLength!==undefined&&t.input.val().length==t.options.maxLength){n.preventDefault()}if(r.hasClass("selected"))r.removeClass("selected");t.lastKey=n.which});this.input.bind("paste",function(n){if(t.options.blurOnPaste){var r=e(this);t.timer=setTimeout(function(){r.blur()},0)}});this.input.blur(function(n){t.currentLabel=e(this).val();t.currentValue=e(this).data("value");if(t.options.allowNewTags){t.timer=setTimeout(function(){t._addTag(t.currentLabel,t.currentValue);t.currentValue="";t.currentLabel=""},400)}e(this).val("").removeData("value");return false});if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(this.options.select){this.select=e('<select class="tagit-hiddenSelect" name="'+(this.element.attr("name")||this.element.data("name"))+'" multiple="multiple"></select>');this.element.after(this.select)}this._initialTags();if(t.options.sortable!==false){var s={items:".tagit-choice",containment:"parent",opacity:.6,tolerance:"pointer",start:function(n,r){t._sortable.tag=e(r.item);t._sortable.origIndex=t._sortable.tag.index()},update:function(e,n){t._sortable.newIndex=t._sortable.tag.index();t._moveTag(t._sortable.origIndex,t._sortable.newIndex);if(t.options.tagsChanged){var r=t.tagsArray[t._sortable.newIndex];t.options.tagsChanged(r.value,"moved",r.element)}}};if(t.options.sortable=="handle"){s.handle="a.ui-icon";s.cursor="move"}t.element.sortable(s)}},_popSelect:function(t){e("option:eq("+t.index+")",this.select).remove();this.select.change()},_addSelect:function(e){this.select.append('<option selected="selected" value="'+e.value+'">'+e.label+"</option>");this.select.change()},_popTag:function(e){if(e===undefined)e=this.tagsArray.pop();else this.tagsArray.splice(e.index,1);for(var t in this.tagsArray)this.tagsArray[t].index=t;if(this.options.select)this._popSelect(e);if(this.options.tagsChanged)this.options.tagsChanged(e?e.value||e.label:null,"popped",e);return},_addTag:function(t,n){this.input.autocomplete("close").val("");if(this._splitAt&&t.search(this._splitAt)>0){var r=t.split(this._splitAt);for(var i=0;i<r.length;i++)this._addTag(r[i],n);return}t=t.replace(/,+$/,"").trim();if(t=="")return false;t=t.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">");var s=this._exists(t,n);if(s!==false){this._highlightExisting(s);return false}var o=this.tag(t,n);o.element=e('<li class="tagit-choice"'+(n!==undefined?' tagValue="'+n+'"':"")+">"+(this.options.sortable=="handle"?'<a class="ui-icon ui-icon-grip-dotted-vertical" style="float:left"></a>':"")+t+'<a class="tagit-close">x</a></li>');o.element.insertBefore(this.input.parent());this.tagsArray.push(o);this.input.val("");if(this.options.select)this._addSelect(o);if(this.options.tagsChanged)this.options.tagsChanged(o.label,"added",o.element);return true},_exists:function(e,t){if(this.tagsArray.length==0)return false;e=this._lowerIfCaseInsensitive(e);t=this._lowerIfCaseInsensitive(t);for(var n in this.tagsArray){if(this._lowerIfCaseInsensitive(this.tagsArray[n].label)==e){if(t!==undefined){if(this._lowerIfCaseInsensitive(this.tagsArray[n].value)==t)return n}else{return n}}}return false},_highlightExisting:function(e){if(this.options.highlightOnExistColor===undefined)return;var t=this.tagsArray[e];t.element.stop();var n=t.element.css("color");t.element.animate({color:this.options.highlightOnExistColor},100).animate({color:n},800)},_isInitKey:function(t){var n="";for(var r in this._keys)if(e.inArray(t,this._keys[r])!=-1)n=r;if(e.inArray(n,this.options.triggerKeys)!=-1)return true;return false},_isTabKey:function(t){var n=this._keys["tab"];return e.inArray(t,n)>-1},_removeTag:function(){this._popTag();this.element.children(".tagit-choice:last").remove()},_backspace:function(e){if(this.input.val()==""){if(this.lastKey==this._keys.backspace){this._popTag();e.remove();this.lastKey=null}else{e.addClass("selected");this.lastKey=this._keys.backspace}}return true},_initialTags:function(){var t=this;var n;if(this.options.tagsChanged)n=this.options.tagsChanged;this.options.tagsChanged=null;if(this.options.initialTags.length!=0){e(this.options.initialTags).each(function(e,n){if(typeof n=="object")t._addTag(n.label,n.value);else t._addTag(n)})}this.options.tagsChanged=n},_lowerIfCaseInsensitive:function(e){if(e===undefined||typeof e!=typeof "a")return e;if(this.options.caseSensitive)return e;return e.toLowerCase()},_moveTag:function(t,n){this.tagsArray.splice(n,0,this.tagsArray.splice(t,1)[0]);for(var r in this.tagsArray)this.tagsArray[r].index=r;if(this.options.select){e("option:eq("+t+")",this.select).insertBefore(e("option:eq("+n+")",this.select))}},tags:function(){return this.tagsArray},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments);this.tagsArray=[]},reset:function(){this.element.find(".tagit-choice").remove();this.tagsArray=[];if(this.options.select){this.select.children().remove();this.select.change()}this._initialTags();if(this.options.tagsChanged)this.options.tagsChanged(null,"reset",null)},fill:function(e){if(e!==undefined)this.options.initialTags=e;this.reset()},add:function(e,t){if(typeof e=="object")return this._addTag(e.label,e.value);else return this._addTag(e,t)},autocomplete:function(){return this.input.data("autocomplete")},tag:function(e,t,n){var r=this;return{label:e,value:t===undefined?e:t,element:n,index:r.tagsArray.length}},remove:function(e,t){if(this.tagsArray.length==0)return false;e=this._lowerIfCaseInsensitive(e);t=this._lowerIfCaseInsensitive(t);for(var n=0;n<this.tagsArray.length;n++){if(this._lowerIfCaseInsensitive(this.tagsArray[n].value)==t||this._lowerIfCaseInsensitive(this.tagsArray[n].label)==e){break}}if(n>=0&&n<this.tagsArray.length){var r=this.tagsArray[n];r.element.remove();this._popTag(r);return true}return false}})})(jQuery)